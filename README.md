# ЛОШ 2024 Стратегия

Программы точно работают на ОС Linux, нужен компилятор g++ версии не ниже 13.

Для запуска программ в Windows выполните инструкции из раздела **Установка WSL**. Если у вас ОС Linux, установите g++ версии хотя бы 13 и переходите к пункту **Установка утилит**.

Если у вас Mac, то ~~страдайте~~ подходите к преподавателям. Возможно, с вашей помощью (и вашим компьютером) мы справимся составить нормальную инструкцию.

## Установка WSL

Пуск -> поиск -> включение или отключение компонентов Windows -> выбрать галочки Подсистема Windows для Linux и Платформа виртуальной машины -> ОК -> Перезагрузить сейчас

Microsoft Store -> Ubuntu 24.04 LTS - Install

В PowerShell выполнить wsl.exe --install, затем wsl.exe --update

Из меню Пуск запустить Ubuntu 24.04 LTS, выполнить установку

## Установка утилит

### Выполнить команду:

```bash
sudo apt install gcc g++ make python3 python3-venv git && git clone "https://github.com/Semen-prog/losh-2024-strategy" && cd losh-2024-strategy && make && mv import_strategy.sh binaries && chmod u+x ./binaries/import_strategy.sh && cd binaries && clear && echo "Please execute ./import_strategy"
```

Скрипт *import_strategy.sh* создаёт ссылку на файл, путь до которого вы укажете. Копирование не производится, вы можете менять исходный файл без повторного вызова команды.

## Использование

Каждый раз перед запуском интерактора выполните `ulimit -s 8388608`.

В папке *binaries* лежат скомпилированные файлы интерактора, валидатора и генератора исходных полей. Использование программ:

### Интерактор

```bash
./interactor field.txt log.txt validate strategy1 strategy2 [strategy3 ...]
```

- *field.txt* - путь до файла с исходным полем;
- *log.txt* путь до файла, в который производится запись лога игры (для последующей визуализации);
- *validate* - путь до скомпилированного фалйа валидатора
- *strategy1, strategy2, ...* - пути до скомпилированных файлов стратегий участников.

Изначально у вашей программы есть 1 секунда на все ходы суммарно. Каждый ход лимит времени увеличивается на 20 миллисекунд.

Для включения дебаг-вывода (например, для вывода полного лога взаимодействия) интерактора надо выполнить в корневой папке репозитория `make debug`. Для дальнейшего запуска без дебаг-вывода надо выполнить `make clean`, затем `make`.

Если вы хотите запустить интерактор с ограничениями, идентичными ограничениям турнира стратегий, запускайте интерактор командой `SECURE=1 ./interactor ...` (т.е. в начало строки запуска интерактора надо добавить `SECURE=1`). Способ не работает для Mac OS.

### Генератор поля

```bash
./fieldgen t n p k [seed [prob]]
```

*t, n, p, k* - параметры из условия.

*seed* - значение *seed* генератора случайных чисел. Если не передать seed, используется значение seed по умолчанию.

*prob* - вероятность в процентах генерации стены. *prob* можно указывать только при указанном *seed*. *prob* может принимать целые значения от 0 до 50 (ероятность в процентах). Если *prob* не указан, используется значение по умолчанию - 15%.

### Валидатор

`validate` - программа валидатора, предусмотрена только для использования вместе с интерактором.

### Визуализатор

Представляем вам визуализатор от одного из участников смены.

Визуализатор должен работать из-под любой операционной системы (кроме, может быть, Mac OS). Для визуализации программы необходимо создать вирутальное окружение и установить туда библиотеки `pygame` и `pygame-ce` (именно в таком порядке). Действия для Linux:

```bash
python3 -m venv vis
. vis/bin/activate
pip install pygame
pip install pygame-ce
./visualize log.txt msec font
```
*log.txt* - путь до файла лога игры. Файл создаётся интерактором, см. использование интерактора (*log.txt*);

*msec* - интервал в миллисекундах между соседними шагами визуализации;

*font* - размер шрифта;

Клавиши навигации:
SPACE - поставить / снять с паузы

Стрелочки - влево на 1 кадр и вправо на один кадр. 

Нажатие (или движение с зажатой левой клавишей) мышкой при открытой нижней панели на точку в ней будет устанавливать время на нажатое 

Клавиши с числами от 0 до 9 устанавливают задержку на кадр равную 10 * нажатое число в милисекундах. 

Просматривать можно только то время, которое было просчитано в ходе проигрывания (рыжая полоса на линии времени) - что бы прочитать все логи до конца за раз, можно просто снять с паузы, и подождать пока игра завершится, а можно нажать на TAB - в таком случае игра без отрисовки считает все ходы, и дальше можно будет свободно просматривать всю игру.

Клавиши управления:

ENTER - показывать нижнюю панель (с графиком счёта и линией времени) 

g - показывать или нет график при открытой нижней панели 

График масштабируется в зависимости от максимального извесного на данный момент игры счёта, так что пока игра не просчитана до конца, он может менять угол.
